var URL=window.URL||window.webkitURL,$image=$("#sc-cropper-image"),$dataX=$("#sc-cropper-dataX"),$dataY=$("#sc-cropper-dataY"),$dataHeight=$("#sc-cropper-dataHeight"),$dataWidth=$("#sc-cropper-dataWidth"),$dataRotate=$("#sc-cropper-dataRotate"),$dataScaleX=$("#sc-cropper-dataScaleX"),$dataScaleY=$("#sc-cropper-dataScaleY"),options={aspectRatio:16/9,preview:".sc-cropper-preview",crop:function(a){$dataX.val(Math.round(a.detail.x)),$dataY.val(Math.round(a.detail.y)),$dataHeight.val(Math.round(a.detail.height)),$dataWidth.val(Math.round(a.detail.width)),$dataRotate.val(a.detail.rotate),$dataScaleX.val(a.detail.scaleX),$dataScaleY.val(a.detail.scaleY)}},$download=$("#sc-cropper-download");void 0===$download[0].download&&$download.addClass("disabled"),scutum.plugins.cropper={},scutum.plugins.cropper.init=function(){scutum.require(["cropper"],function(){scutum.plugins.cropper.initPlugin(),scutum.plugins.cropper.methods(),scutum.plugins.cropper.aspectRatio(),scutum.plugins.cropper.uploadImage()})},scutum.plugins.cropper.initPlugin=function(){$image.on({ready:function(a){},cropstart:function(a){},cropmove:function(a){},cropend:function(a){},crop:function(a){},zoom:function(a){}}).cropper(options)},scutum.plugins.cropper.aspectRatio=function(){$("[data-aspect-ratio]").on("click",function(){$(this).addClass("uk-active").siblings().removeClass("uk-active"),options.aspectRatio=$(this).attr("data-aspect-ratio"),$image.cropper("destroy").cropper(options)})},scutum.plugins.cropper.methods=function(){var a=$(".sc-cropper-buttons");a.find("button[data-method]").each(function(){UIkit.tooltip($(this))}),a.on("click","[data-method]",function(){var a,t,o,e=$(this),i=e.hasClass("sc-button-radio"),c=e.data(),r=$image.data("cropper"),p=$image.attr("src"),s="image/jpeg";if(!e.prop("disabled")&&!e.hasClass("disabled")&&r&&c.method){if(i&&(e.closest(".uk-button-group").find(".sc-button-radio").removeClass("uk-active"),e.addClass("uk-active")),void 0!==(c=$.extend({},c)).target&&(a=$(c.target),void 0===c.option))try{c.option=JSON.parse(a.val())}catch(a){console.log(a.message)}switch(r=r.cropped,c.method){case"rotate":r&&0<options.viewMode&&$image.cropper("clear");break;case"getCroppedCanvas":c.option||(c.option={}),c.option.fillColor="#fff"}switch(t=$image.cropper(c.method,c.option,c.secondOption),c.method){case"rotate":r&&0<options.viewMode&&$image.cropper("crop");break;case"scaleX":case"scaleY":$(this).data("option",-c.option);break;case"getCroppedCanvas":t&&(r=$("#sc-getCroppedCanvasModal"),UIkit.modal(r).show(),r.find(".uk-modal-body").html(t),$download.hasClass("disabled")||($download.download="cropped.jpg",$download.attr("href",t.toDataURL(s))));break;case"destroy":o&&(URL.revokeObjectURL(o),o="",$image.attr("src",p))}if($.isPlainObject(t)&&a)try{a.val(JSON.stringify(t))}catch(a){console.log(a.message)}}})},scutum.plugins.cropper.uploadImage=function(){var t,o=$("#sc-cropper-inputImage");URL?o.change(function(){var a=this.files;$image.data("cropper")&&a&&a.length&&(a=a[0],/^image\/\w+$/.test(a.type)?(a.name,a.type,t&&URL.revokeObjectURL(t),t=URL.createObjectURL(a),$image.cropper("destroy").attr("src",t).cropper(options),o.val("")):window.alert("Please choose an image file."))}):o.prop("disabled",!0).parent().addClass("disabled")};